<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìä Veille Metz ‚Äì Syst√®me Automatis√©</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1>üìä Veille Metz ‚Äì Syst√®me Automatis√©</h1>
                <div class="header-info">
                    <div class="periode" id="periode">Semaine du 27 octobre au 9 novembre 2025</div>
                    <div class="derniere-maj" id="derniereMaj">Derni√®re mise √† jour : 3 novembre 2025 √† 10h35</div>
                </div>
            </div>
            <button class="btn btn--primary btn-refresh" id="btnRefresh">
                <span class="refresh-icon">üîÑ</span> Actualiser la veille
            </button>
        </header>

        <!-- Dashboard Cards -->
        <div class="dashboard">
            <div class="card card-stat" style="background: var(--color-bg-1);">
                <div class="card-icon">üèôÔ∏è</div>
                <div class="card-content">
                    <div class="card-value" id="countVille">27</div>
                    <div class="card-label">Actualit√©s Ville</div>
                </div>
            </div>
            <div class="card card-stat" style="background: var(--color-bg-3);">
                <div class="card-icon">üí∞</div>
                <div class="card-content">
                    <div class="card-value" id="countBudget">9</div>
                    <div class="card-label">Donn√©es Budg√©taires</div>
                </div>
            </div>
            <div class="card card-stat" style="background: var(--color-bg-5);">
                <div class="card-icon">üíº</div>
                <div class="card-content">
                    <div class="card-value" id="countEmploi">19</div>
                    <div class="card-label">Offres d'Emploi</div>
                </div>
            </div>
        </div>

        <!-- Loading Overlay -->
        <div class="loading-overlay" id="loadingOverlay">
            <div class="spinner"></div>
            <p>Actualisation en cours...</p>
        </div>

        <!-- Notification Toast -->
        <div class="toast" id="toast"></div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab-btn active" data-tab="resume">üìÑ R√©sum√© Narratif</button>
            <button class="tab-btn" data-tab="tableau">üìä Tableau Structur√©</button>
            <button class="tab-btn" data-tab="visualisations">üìà Visualisations</button>
            <button class="tab-btn" data-tab="parametres">‚öôÔ∏è Param√®tres</button>
        </div>

        <!-- Tab Content -->
        <div class="tab-content">
            <!-- Onglet 1: R√©sum√© Narratif -->
            <div class="tab-panel active" id="resume">
                <div class="card">
                    <div class="card__body">
                        <div class="actions-bar">
                            <button class="btn btn--secondary" id="btnDownloadPDF">
                                ‚¨áÔ∏è T√©l√©charger en PDF
                            </button>
                            <button class="btn btn--secondary" id="btnCopyResume">
                                üìã Copier le r√©sum√©
                            </button>
                        </div>
                        <div class="resume-content" id="resumeContent">
                            <h2>Veille Metz ‚Äì R√©sum√© Narratif</h2>
                            <p class="resume-periode">P√©riode : 27 octobre au 9 novembre 2025</p>
                            
                            <h3>üèôÔ∏è Actualit√©s Ville (27 articles)</h3>
                            <ul>
                                <li><strong>Lancement campagne √©lectorale 2026</strong> : Bertrand Mertz officialise sa candidature aux municipales 2026 au Clo√Ætre des R√©collets (2340 partages).</li>
                                <li><strong>Euro Marathon 2025 : succ√®s international</strong> : 4500 coureurs de 35 pays participent √† la 12e √©dition, confirmant Metz comme destination marathon (7890 partages).</li>
                                <li><strong>Moselle Open ATP 250</strong> : Derni√®re √©dition du tournoi de tennis international avant relocalisation en 2026 (5670 partages).</li>
                                <li><strong>Infrastructure et mobilit√©</strong> : √âtudes lanc√©es pour extension tramway T2 vers Sablon (horizon 2030), nouvelle zone 30 km/h au centre-ville pour mobilit√© douce.</li>
                                <li><strong>Culture et patrimoine</strong> : Centre Pompidou-Metz accueille exposition Surr√©alisme (nov 2025-f√©v 2026), restauration fa√ßade Cath√©drale Saint-√âtienne lanc√©e, Festival Jazz automne-hiver.</li>
                                <li><strong>Transition √©nerg√©tique</strong> : Plan municipal vers chauffage g√©othermique et pompes √† chaleur pour b√¢timents publics d'ici 2030.</li>
                                <li><strong>Logements et urbanisme</strong> : Construction 120 logements sociaux rue Faubourg Saint-Jean (livraison fin 2026), r√©habilitation √éles Chambi√®re phase 3.</li>
                                <li><strong>√âducation et jeunesse</strong> : R√©novation √©coles maternelles Lorraine et Graffenstaden (2.3 M‚Ç¨), nouveau centre socio-culturel Bellecroix pour jeunes 13-25 ans.</li>
                            </ul>

                            <h3>üí∞ Donn√©es Budg√©taires (9 articles)</h3>
                            <ul>
                                <li><strong>Budget primitif 2025 : 246 M‚Ç¨ (+9%)</strong> : D√©penses fonctionnement 171 M‚Ç¨, investissements 75 M‚Ç¨. Endettement pr√©visionnel 137 M‚Ç¨.</li>
                                <li><strong>Rapport CRC positif</strong> : Faible endettement (7.4% CAF), bonne tr√©sorerie, mais seulement 44% du plan 2022-2026 r√©alis√©s - appel √† acc√©l√©ration investissements.</li>
                                <li><strong>Compte administratif 2024</strong> : R√©sultat d'exploitation positif 3.2 M‚Ç¨, endettement stable, investissements renforc√©s.</li>
                                <li><strong>Nouveaux emprunts</strong> : Ligne de cr√©dit 50 M‚Ç¨ contract√©e pour financer infrastructures et r√©novations majeures.</li>
                                <li><strong>Fiscalit√© locale stable</strong> : Taux taxe habitation et fonci√®re maintenus, pas d'augmentation en 2025.</li>
                                <li><strong>Subventions associations</strong> : Enveloppe 4.5 M‚Ç¨ pour activit√©s culturelles, sociales, sportives, environnementales.</li>
                                <li><strong>Transports</strong> : Plan 80 M‚Ç¨ 2025-2027 pour extension tramway et √©lectrification bus Eurom√©tropole.</li>
                                <li><strong>Eau et assainissement</strong> : Redevance augmente mod√©r√©ment (+2%) pour investissements r√©seau souterrain.</li>
                            </ul>

                            <h3>üíº Offres d'Emploi ‚Äì Collaborateurs Parlementaires</h3>
                            <ul>
                                <li><strong>4 nouvelles opportunit√©s identifi√©es</strong> : Attach√©(e) parlementaire aupr√®s du S√©nateur Yan Chantrel (CDI, Fran√ßais √©tablis hors de France), Attach√©(e) en circonscription pour Thierry Sother (CDI, missions communication et gestion dossiers).</li>
                                <li><strong>Concours Assembl√©e Nationale</strong> : Ouverture du concours externe pour 25 postes d'administrateur-adjoint (inscriptions novembre-d√©cembre 2024, √©preuves f√©vrier-mai 2025).</li>
                                <li><strong>Groupe LIOT</strong> : Recrutement d'un(e) conseiller(e) Affaires sociales, Culture et √âducation avec expertise secteur public et capacit√©s d'analyse requises.</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Onglet 2: Tableau Structur√© -->
            <div class="tab-panel" id="tableau">
                <div class="card">
                    <div class="card__body">
                        <div class="tableau-controls">
                            <div class="search-filter">
                                <input type="text" id="searchInput" class="form-control" placeholder="üîç Rechercher...">
                                <select id="voletFilter" class="form-control">
                                    <option value="tous">Tous les volets</option>
                                    <option value="Ville">üèôÔ∏è Ville</option>
                                    <option value="Budget">üí∞ Budget</option>
                                    <option value="Emploi">üíº Emploi</option>
                                </select>
                                <select id="sortBy" class="form-control">
                                    <option value="date-desc">Date (r√©cent ‚Üí ancien)</option>
                                    <option value="date-asc">Date (ancien ‚Üí r√©cent)</option>
                                    <option value="volet">Volet</option>
                                    <option value="source">Source</option>
                                </select>
                            </div>
                            <button class="btn btn--primary" id="btnExportCSV">
                                ‚¨áÔ∏è Exporter en CSV
                            </button>
                        </div>
                        <div class="table-container">
                            <table class="data-table" id="dataTable">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Volet</th>
                                        <th>Source</th>
                                        <th>Titre</th>
                                        <th>R√©sum√©</th>
                                        <th>Lien</th>
                                        <th>Engagement</th>
                                    </tr>
                                </thead>
                                <tbody id="tableBody">
                                    <!-- Populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                        <div class="pagination" id="paginationControls">
                            <button class="btn btn--secondary btn--sm" id="prevPage">‚óÄÔ∏è Pr√©c√©dent</button>
                            <span id="pageInfo" style="margin: 0 var(--space-12); color: var(--color-text-secondary);"></span>
                            <button class="btn btn--secondary btn--sm" id="nextPage">Suivant ‚ñ∂Ô∏è</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Onglet 3: Visualisations -->
            <div class="tab-panel" id="visualisations">
                <div class="vis-grid">
                    <div class="card">
                        <div class="card__body">
                            <h3>R√©partition par volet</h3>
                            <div class="chart-container" style="height: 300px;">
                                <canvas id="chartVolet"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card__body">
                            <h3>Volume par source</h3>
                            <div class="chart-container" style="height: 300px;">
                                <canvas id="chartSource"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card__body">
                        <h3>Statistiques g√©n√©rales</h3>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-value" id="statTotal">15</div>
                                <div class="stat-label">Total d'articles</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="statSources">8</div>
                                <div class="stat-label">Sources uniques</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="statEngagement">2 156</div>
                                <div class="stat-label">Engagement moyen</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Onglet 4: Param√®tres -->
            <div class="tab-panel" id="parametres">
                <div class="card">
                    <div class="card__body">
                        <h3>üåê Sources Web &amp; Scraping</h3>
                        <p class="section-desc">G√©rez les sources de donn√©es externes et testez la r√©cup√©ration en temps r√©el.</p>
                        
                        <div class="sources-manager">
                            <div class="source-list" id="sourceList">
                                <!-- Populated by JavaScript -->
                            </div>
                            
                            <div class="add-source">
                                <h4>Ajouter une source</h4>
                                <div class="form-group">
                                    <label class="form-label">Nom de la source</label>
                                    <input type="text" id="inputSourceName" class="form-control" placeholder="Ex: R√©publicain Lorrain">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">URL (flux RSS ou API)</label>
                                    <input type="url" id="inputSourceURL" class="form-control" placeholder="https://exemple.fr/rss">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Type</label>
                                    <select id="inputSourceType" class="form-control">
                                        <option value="rss">Flux RSS</option>
                                        <option value="api">API JSON</option>
                                        <option value="web">Page Web</option>
                                    </select>
                                </div>
                                <div class="btn-group">
                                    <button class="btn btn--primary" id="btnAddSource">‚ûï Ajouter la source</button>
                                    <button class="btn btn--secondary" id="btnTestConnection">üîå Tester la connexion</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="scraper-section">
                            <h4>ü§ñ Scraper automatique</h4>
                            <p>Lancez une r√©cup√©ration des donn√©es depuis toutes les sources configur√©es.</p>
                            <button class="btn btn--primary btn-large" id="btnScrapeNow">üîÑ Scraper maintenant</button>
                            <div class="scraper-log" id="scraperLog"></div>
                        </div>
                        
                        <div class="import-export-section">
                            <h4>üìÅ Import / Export de donn√©es</h4>
                            <div class="btn-group">
                                <button class="btn btn--secondary" id="btnExportJSON">‚¨áÔ∏è Exporter data.json</button>
                                <button class="btn btn--secondary" id="btnImportCSV">‚¨ÜÔ∏è Importer CSV</button>
                            </div>
                            <div class="dropzone" id="dropzone">
                                <p>üìé Glissez-d√©posez un fichier CSV ici</p>
                                <input type="file" id="fileInput" accept=".csv,.json" style="display: none;">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section Email -->
        <div class="card email-section">
            <div class="card__body">
                <h3>üìß Partage par e-mail</h3>
                <div class="email-preview" id="emailPreview">
                    <div class="email-field">
                        <strong>Objet :</strong> <span id="emailSubject">Veille Metz ‚Äì [dates]</span>
                    </div>
                    <div class="email-body" id="emailBody"></div>
                </div>
                <div class="email-actions">
                    <button class="btn btn--primary" id="btnCopyEmail">
                        üìß Copier l'email complet
                    </button>
                    <button class="btn btn--secondary" id="btnGenerateLink">
                        üìé G√©n√©rer lien de partage
                    </button>
                </div>
                <div class="share-link" id="shareLink" style="display: none;">
                    <strong>Lien de partage g√©n√©r√© :</strong>
                    <div class="link-display" id="linkDisplay"></div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <p>Veille bihebdomadaire ‚Äì Usage personnel | G√©n√©r√© le <span id="footerDate">3 novembre 2025</span></p>
        </footer>
    </div>

    <script src="app.js"></script>
</body>
</html>